<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Environment set-up</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: #990073
   }

   pre .number {
     color: #099;
   }

   pre .comment {
     color: #998;
     font-style: italic
   }

   pre .keyword {
     color: #900;
     font-weight: bold
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: #d14;
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>

<!-- MathJax scripts -->
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<p>In this vignette, we illustrate the use of the sequential quadratic
programming (SQP) algorithm implemented in <code>mixsqp</code>, and we compare
its runtime and accuracy against an interior-point (IP) solver
implemented by the <a href="https://www.mosek.com">MOSEK</a> commercial software (it is called by
the &ldquo;KWDual&rdquo; function in the <a href="https://cran.r-project.org/package=REBayes">REBayes package</a>).</p>

<p>If you do not have the Rmosek and REBayes packages installed on your
computer, you may skip over these steps in the vignette.</p>

<h2>Environment set-up</h2>

<p>Load the <code>mixsqp</code> package.</p>

<pre><code class="r">library(mixsqp)
</code></pre>

<p>Next, initialize the sequence of pseudorandom numbers.</p>

<pre><code class="r">set.seed(1)
</code></pre>

<h2>Generate a small data set</h2>

<p>We begin with a small example to show how <code>mixsqp</code> works.</p>

<pre><code class="r">L &lt;- simulatemixdata(1000,20)$L
dim(L)
# [1] 1000   20
</code></pre>

<p>This call to <code>simulatemixdata</code> created an \(n \times m\) conditional
likelihood matrix for a mixture of zero-centered normals, with \(n =
1000\) and \(m = 20\). By default, <code>simulatemixdata</code> normalizes the rows
of the likelihood matrix so that the maximum entry in each row is 1.</p>

<h2>Fit mixture model</h2>

<p>Now we fit the mixture model using the SQP algorithm:</p>

<pre><code class="r">fit.sqp &lt;- mixsqp(L)
# Running mix-SQP algorithm 0.1-97 on 1000 x 20 matrix
# convergence tol. (SQP):     1.0e-08
# conv. tol. (active-set):    1.0e-10
# zero threshold (solution):  1.0e-06
# zero thresh. (search dir.): 1.0e-08
# l.s. sufficient decrease:   1.0e-02
# step size reduction factor: 5.0e-01
# minimum step size:          1.0e-04
# max. iter (SQP):            1000
# max. iter (active-set):     21
# iter        objective max(rdual) nnz stepsize max.diff nqp nls
#    1 +7.434938010e-01 +2.102e-01  20       NA       NA  NA  NA
#    2 +7.117754572e-01 +2.699e+00   3 1.00e+00 4.50e-01  21   1
#    3 +6.626763592e-01 +1.122e+00   4 1.00e+00 5.00e-01   7   1
#    4 +6.457951080e-01 +4.098e-01   5 1.00e+00 2.42e-01  10   1
#    5 +6.360610080e-01 +1.208e-01   4 1.00e+00 3.45e-02   3   1
#    6 +6.319543790e-01 +2.485e-02   5 1.00e+00 1.98e-01   4   1
#    7 +6.288012408e-01 +3.648e-03   4 1.00e+00 8.65e-02   3   1
#    8 +6.282103967e-01 +6.952e-05   4 1.00e+00 8.95e-03   2   1
#    9 +6.281978283e-01 -1.570e-08   4 1.00e+00 1.40e-04   2   1
# Convergence criteria met---optimal solution found.
</code></pre>

<p>In this example, the SQP algorithm converged to a solution in a small
number of iterations.</p>

<p>By default, <code>mixsqp</code> outputs information on its progress. It begins by
summarizing the optimization problem and the algorithm settings used.
(Since we did not change these settings in the <code>mixsqp</code> call, all the
settings shown here are the default settings.)</p>

<p>After that, it outputs, at each iteration, information about the
current solution, such as the value of the objective (&ldquo;objective&rdquo;) and
the number of nonzeros (&ldquo;nnz&rdquo;).</p>

<p>The &ldquo;max(rdual)&rdquo; column shows the quantity used to assess convergence.
It reports the maximum value of the &ldquo;dual residual&rdquo;; the SQP solver
terminates when the maximum dual residual is less than <code>conv.tol</code>,
which by default is \(10^{-8}\). In this example, we see that the dual
residual shrinks rapidly toward zero.</p>

<p>Another useful indicator of convergence is the &ldquo;max.diff&rdquo; column&mdash;it
reports the maximum difference between the solution estimates at two
successive iterations. We normally expect these differences to shrink
as we approach the solution, which is precisely what we see in this
example.</p>

<p>This information is also provided in the return value, which we can
use, for example, to create a plot of the objective value at each
iteration of the SQP algorithm:</p>

<pre><code class="r">numiter &lt;- nrow(fit.sqp$progress)
plot(1:numiter,fit.sqp$progress$objective,type = &quot;b&quot;,
     pch = 20,lwd = 2,xlab = &quot;SQP iteration&quot;,
     ylab = &quot;objective&quot;,xaxp = c(1,numiter,numiter - 1))
</code></pre>

<p><img src="data:image/png;base64,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" title="plot of chunk plot-sqp-progress" alt="plot of chunk plot-sqp-progress" style="display: block; margin: auto;" /></p>

<p>To assess the accuracy of the SQP solution, we can compare against the
solution computed by the IP algorithm. (If you do not have the REBayes
package installed, you can skip this step.)</p>

<pre><code class="r">fit.ip &lt;- mixkwdual(L)
</code></pre>

<p>If you run the IP algorithm, you should see that the IP and SQP
solutions achieve nearly the same objective value.</p>

<pre><code class="r">cat(sprintf(&quot;Objective at SQP solution: %0.16f\n&quot;,fit.sqp$value,digits = 16))
cat(sprintf(&quot;Objective at IP solution:  %0.16f\n&quot;,fit.ip$value,digits = 16))
cat(sprintf(&quot;Difference in objectives:  %0.4e\n&quot;,fit.sqp$value - fit.ip$value))
# Objective at SQP solution: 0.6281978495824518
# Objective at IP solution:  0.6281978456083795
# Difference in objectives:  3.9741e-09
</code></pre>

<h2>Comparing the SQP and IP solvers in a large data set</h2>

<p>We observed that the SQP and IP methods achieve nearly the same
solution quality in the example above. Here, we explore the
computational properties of the SQP and IP algorithms in a larger data
set.</p>

<p>As before, we compute the \(n \times m\) likelihood matrix for a mixture
of zero-centered normals. This time, we use a finer grid of \(m = 100\)
normal densities, as well as many more samples.</p>

<pre><code class="r">L &lt;- simulatemixdata(1e5,100)$L
dim(L)
# [1] 100000    100
</code></pre>

<p>Now we fit the model using the SQP algorithm:</p>

<pre><code class="r">timing &lt;- system.time(fit.sqp &lt;- mixsqp(L))
cat(sprintf(&quot;Computation took %0.2f seconds\n&quot;,timing[&quot;elapsed&quot;]))
# Running mix-SQP algorithm 0.1-97 on 100000 x 100 matrix
# convergence tol. (SQP):     1.0e-08
# conv. tol. (active-set):    1.0e-10
# zero threshold (solution):  1.0e-06
# zero thresh. (search dir.): 1.0e-08
# l.s. sufficient decrease:   1.0e-02
# step size reduction factor: 5.0e-01
# minimum step size:          1.0e-04
# max. iter (SQP):            1000
# max. iter (active-set):     101
# iter        objective max(rdual) nnz stepsize max.diff nqp nls
#    1 +7.790692288e-01 +2.447e-01 100       NA       NA  NA  NA
#    2 +6.927578980e-01 +2.219e+01   4 1.00e+00 3.62e-01 101   1
#    3 +6.371645565e-01 +9.824e+00   7 1.00e+00 4.91e-01  47   1
#    4 +6.233189089e-01 +4.545e+00   4 1.00e+00 2.07e-01  14   1
#    5 +6.177060975e-01 +1.251e+00   5 1.00e+00 2.97e-01  13   1
#    6 +6.160189730e-01 +2.574e-01   5 1.00e+00 2.73e-01  14   1
#    7 +6.152400931e-01 +4.100e-02   5 1.00e+00 2.19e-01  35   1
#    8 +6.150662462e-01 +4.111e-03   7 1.00e+00 1.02e-01  24   1
#    9 +6.150526241e-01 +2.241e-04   7 1.00e+00 2.80e-03   2   1
#   10 +6.150522124e-01 +9.288e-07   7 1.00e+00 9.53e-04   2   1
#   11 +6.150522078e-01 -1.543e-08   7 1.00e+00 1.14e-05   2   1
# Convergence criteria met---optimal solution found.
# Computation took 3.31 seconds
</code></pre>

<p>If you have the REBayes package, you can also run the IP method:</p>

<pre><code class="r">timing &lt;- system.time(fit.ip  &lt;- mixkwdual(L))
cat(sprintf(&quot;Computation took %0.2f seconds\n&quot;,timing[&quot;elapsed&quot;]))
# Computation took 21.16 seconds
</code></pre>

<p>If you run the IP algorithm, you should find that the SQP algorithm was
considerably faster than the IP solver, and it converged to a solution
with nearly the same objective value as the IP solution.</p>

<pre><code class="r">cat(sprintf(&quot;Objective at SQP solution: %0.16f\n&quot;,fit.sqp$value,digits = 16))
cat(sprintf(&quot;Objective at IP solution:  %0.16f\n&quot;,fit.ip$value,digits = 16))
cat(sprintf(&quot;Difference in objectives:  %0.4e\n&quot;,fit.sqp$value - fit.ip$value))
# Objective at SQP solution: 0.6150522313978172
# Objective at IP solution:  0.6150522313757819
# Difference in objectives:  2.2035e-11
</code></pre>

<h2>Session information</h2>

<p>This next code chunk gives information about the computing environment
used to generate the results contained in this vignette, including the
version of R and the packages used.</p>

<pre><code class="r">sessionInfo()
# R version 3.5.1 (2018-07-02)
# Platform: x86_64-pc-linux-gnu (64-bit)
# Running under: Scientific Linux 7.4 (Nitrogen)
# 
# Matrix products: default
# BLAS/LAPACK: /software/openblas-0.2.19-el7-x86_64/lib/libopenblas_haswellp-r0.2.19.so
# 
# locale:
# [1] C
# 
# attached base packages:
# [1] stats     graphics  grDevices utils     datasets  methods   base     
# 
# other attached packages:
# [1] mixsqp_0.1-97
# 
# loaded via a namespace (and not attached):
#  [1] compiler_3.5.1  Matrix_1.2-15   magrittr_1.5    tools_3.5.1    
#  [5] Rcpp_1.0.0      Rmosek_8.0.69   stringi_1.2.4   highr_0.7      
#  [9] grid_3.5.1      REBayes_1.4     knitr_1.20      stringr_1.3.1  
# [13] lattice_0.20-38 evaluate_0.12
</code></pre>

</body>

</html>
